
# Техническое задание: Secure Messenger (FastAPI + Django + React PWA) - Название Secure Drop

## 1. Общая информация

**Цель:**
Создать безопасный мессенджер с **end-to-end шифрованием (AES-256)**, поддержкой текста, emoji и фото, с регистрацией/входом через **TOTP**, фронтенд на **Django + React + TypeScript** с PWA и SPA-подобным поведением.

**Технологии:**

* **Backend:** FastAPI + Uvicorn
* **Frontend:** Django (backend для статики и API) + React + TypeScript (SPA, PWA)
* **База данных:** PostgreSQL
* **Docker + Docker Compose**
* **TOTP** для аутентификации
* **E2EE** для сообщений и фото (AES-256)

---

## 2. Функциональные требования

### 2.1 Регистрация и аутентификация

* Регистрация через **TOTP**:

  * Пользователь выбирает username
  * Генерируется **секретный ключ TOTP**
  * Отображается QR-код для сканирования (Google Authenticator, Authy и т.д.)
* Вход через **TOTP**:

  * Ввод username + текущий TOTP-код
* JWT для сессий и авторизации
* Возможность выхода и сброса токена

### 2.2 Обмен сообщениями

* Текстовые сообщения + emoji
* Фото (jpg, png)
* Сообщения и фото **шифруются на клиенте AES-256**, сервер хранит **только зашифрованные данные**
* Дешифровка только на клиенте (**E2EE**)

### 2.3 Контакты / чат

* Добавление контактов через username
* Личные чаты 1:1
* SPA-подобная навигация: мгновенное открытие чатов без перезагрузки страницы

### 2.4 Безопасность

* HTTPS/TLS для всех соединений
* AES-256 для шифрования сообщений и фото
* JWT для сессий
* Сервер **не хранит ключи расшифровки**

### 2.5 Хранение данных

* **Пользователи:** `id`, `username`, `totp_secret`, `created_at`
* **Контакты:** `user_id`, `contact_id`
* **Сообщения:** `id`, `sender_id`, `receiver_id`, `message_encrypted`, `created_at`
* **Фото:** `id`, `sender_id`, `receiver_id`, `file_path`, `created_at`

---

## 3. Архитектура

### 3.1 Backend (FastAPI)

* Эндпоинты:

  * `/register` — регистрация username + выдача TOTP QR-кода / секрета
  * `/login` — вход по username + TOTP-код
  * `/send_message` — отправка зашифрованного сообщения
  * `/get_messages` — получение сообщений
  * `/send_photo` — отправка фото
  * `/get_photo` — получение фото
* JWT для авторизации
* Docker-контейнер с Uvicorn

### 3.2 Frontend

* **Django**: статика, PWA сервис-воркеры, API proxy (по желанию)
* **React + TypeScript**: SPA-подобное поведение, динамическая загрузка чатов и сообщений
* **PWA**: offline support для последних сообщений и кеширование статических файлов
* **AES-256**: шифрование и дешифровка сообщений и фото на клиенте

---

## 4. Docker & Docker Compose

* Backend контейнер (FastAPI + Uvicorn)
* Frontend контейнер (Django + React build)
* PostgreSQL контейнер
* docker-compose.yml должен запускать все сервисы одной командой

---

## 5. MVP Scope

* Регистрация/вход через TOTP + QR-код
* SPA на React/TS с PWA
* Отправка/получение текстовых сообщений и emoji
* Отправка/получение фото
* End-to-end шифрование AES-256
* Docker + Docker Compose

